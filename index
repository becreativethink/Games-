<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WordWar ‚Äî Home</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
  <a href="index.html" class="nav-logo">
    <span class="w1">WORD</span><span class="w2">WAR</span>
  </a>
  <div class="nav-links">
    <a href="index.html"       class="nav-link active">Home</a>
    <a href="leaderboard.html" class="nav-link">Leaderboard</a>
    <a href="profile.html"     class="nav-link">Profile</a>
    <div class="nav-sep"></div>
    <a href="profile.html" class="user-badge" id="user-badge">
      <img class="ub-avatar" id="nav-avatar" src="" alt="" />
      <span class="ub-name"  id="nav-username">‚Ä¶</span>
      <div class="online-dot"></div>
    </a>
    <button onclick="doLogout()" class="nav-link btn-ghost" style="cursor:pointer;color:var(--text2);border:none;">Logout</button>
  </div>
</nav>

<!-- Hero -->
<div class="hero">
  <h1><span class="accent">Choose</span> Your Battle</h1>
  <p class="mt-8">Guess secret words, crush opponents, climb the ranks. Your next word war starts now.</p>
</div>

<!-- Currency strip -->
<div class="currency-strip">
  <div class="cur-item">
    <span class="cur-icon">üí∞</span>
    <div>
      <div class="cur-val" id="bar-money">‚Äî</div>
      <div class="cur-lbl">Money</div>
    </div>
  </div>
  <div class="cur-item">
    <span class="cur-icon">‚≠ê</span>
    <div>
      <div class="cur-val" id="bar-score">‚Äî</div>
      <div class="cur-lbl">Score</div>
    </div>
  </div>
  <div class="cur-item">
    <span class="cur-icon">üèÜ</span>
    <div>
      <div class="cur-val" id="bar-wins">‚Äî</div>
      <div class="cur-lbl">Wins</div>
    </div>
  </div>
</div>

<!-- Mode selector -->
<div class="mode-grid">
  <div class="mode-card offline" onclick="selectMode('offline')">
    <span class="mode-icon">ü§ù</span>
    <h3>Offline Mode</h3>
    <p>Pass-and-play on one device. One player sets the word, the other guesses.</p>
    <span class="mode-pill pill-green">Free to play</span>
  </div>

  <div class="mode-card online" onclick="selectMode('online')">
    <span class="mode-icon">üåê</span>
    <h3>Online Multiplayer</h3>
    <p>Create or join a room, set a bet, and battle a real opponent in real-time.</p>
    <span class="mode-pill pill-purple">Score Betting</span>
  </div>

  <div class="mode-card daily" onclick="selectMode('daily')">
    <span class="mode-icon">üìÖ</span>
    <h3>Daily Challenge</h3>
    <p>One mystery word per day. 60 seconds. Win exclusive money & score rewards.</p>
    <span class="mode-pill pill-gold">Daily Rewards</span>
  </div>
</div>

<!-- Quick stats -->
<div class="stats-section">
  <div class="card">
    <div class="flex items-center justify-between mb-16">
      <h3>Your Stats</h3>
      <a href="profile.html" class="btn btn-ghost btn-sm">Full Profile ‚Üí</a>
    </div>

    <div class="stat-grid">
      <div class="stat-card">
        <span class="stat-val text-green"  id="qs-wins">‚Äî</span>
        <span class="stat-lbl">Wins</span>
      </div>
      <div class="stat-card">
        <span class="stat-val text-red"    id="qs-losses">‚Äî</span>
        <span class="stat-lbl">Losses</span>
      </div>
      <div class="stat-card">
        <span class="stat-val"             id="qs-total">‚Äî</span>
        <span class="stat-lbl">Games</span>
      </div>
      <div class="stat-card">
        <span class="stat-val text-accent" id="qs-score">‚Äî</span>
        <span class="stat-lbl">Score</span>
      </div>
      <div class="stat-card">
        <span class="stat-val text-gold"   id="qs-money">‚Äî</span>
        <span class="stat-lbl">Money</span>
      </div>
      <div class="stat-card">
        <span class="stat-val text-accent2" id="qs-level">‚Äî</span>
        <span class="stat-lbl">Level</span>
      </div>
    </div>

    <div class="lv-wrap">
      <div class="lv-info">
        <span id="lbl-level">Level 1</span>
        <span id="lbl-progress" class="text-faint">0% to next level</span>
      </div>
      <div class="lv-track">
        <div class="lv-fill" id="level-fill" style="width:0%"></div>
      </div>
    </div>
  </div>
</div>

<script type="module">
import { requireAuth, logoutUser, db, ref, onValue } from './firebase-config.js';
import { showToast, getLevel, getLevelProgress, avatarUrl, fmtNum } from './main.js';

const user = requireAuth('login.html');
if (!user) throw new Error('Not authenticated');

document.getElementById('nav-username').textContent = user.username;
document.getElementById('nav-avatar').src = avatarUrl(user.photoURL, user.username);

onValue(ref(db, 'users/' + user.uid), snap => {
  if (!snap.exists()) return;
  const d = snap.val();

  document.getElementById('bar-money').textContent = fmtNum(d.money);
  document.getElementById('bar-score').textContent = fmtNum(d.score);
  document.getElementById('bar-wins').textContent  = fmtNum(d.wins);

  document.getElementById('qs-wins').textContent   = fmtNum(d.wins);
  document.getElementById('qs-losses').textContent = fmtNum(d.losses);
  document.getElementById('qs-total').textContent  = fmtNum(d.totalGames);
  document.getElementById('qs-score').textContent  = fmtNum(d.score);
  document.getElementById('qs-money').textContent  = fmtNum(d.money);

  const lvl = getLevel(d.score);
  const pct = getLevelProgress(d.score);
  document.getElementById('qs-level').textContent     = lvl;
  document.getElementById('lbl-level').textContent    = `Level ${lvl}`;
  document.getElementById('lbl-progress').textContent = `${Math.round(pct)}% to next level`;
  document.getElementById('level-fill').style.width   = pct + '%';
});

window.selectMode = function(mode) {
  sessionStorage.setItem('ww_mode', mode);
  window.location.href = 'game.html';
};

window.doLogout = async function() {
  await logoutUser(user.uid);
  window.location.href = 'login.html';
};
</script>
</body>
</html>
