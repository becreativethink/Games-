<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WordWar ‚Äî Home</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
  <span class="navbar-logo">WORD<span style="color:var(--text)">WAR</span></span>
  <div class="navbar-links">
    <a href="index.html" class="active">Home</a>
    <a href="leaderboard.html">Leaderboard</a>
    <a href="profile.html">Profile</a>
    <div class="user-badge" id="user-badge" onclick="window.location.href='profile.html'">
      <img id="nav-avatar" src="" alt="avatar" />
      <span class="user-badge-name" id="nav-username">‚Ä¶</span>
      <div class="online-dot"></div>
    </div>
    <button onclick="doLogout()" class="btn btn-secondary btn-sm">Logout</button>
  </div>
</nav>

<!-- Hero -->
<div style="text-align:center;padding:48px 24px 16px;">
  <h1 style="background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;">
    Choose Your Battle
  </h1>
  <p class="text-muted mt-8" style="max-width:480px;margin:8px auto 0;">
    Guess secret words, crush opponents, climb the ranks.<br/>
    Your next word war starts here.
  </p>
</div>

<!-- Currency bar -->
<div class="flex items-center justify-center gap-24 mt-16 mb-8" id="currency-bar" style="flex-wrap:wrap;">
  <div class="flex items-center gap-8">
    <span style="font-size:1.4rem;">üí∞</span>
    <div>
      <div class="text-mono" id="bar-money" style="font-weight:700;font-size:1.1rem;">‚Äî</div>
      <div class="text-xs text-muted">Money</div>
    </div>
  </div>
  <div class="flex items-center gap-8">
    <span style="font-size:1.4rem;">‚≠ê</span>
    <div>
      <div class="text-mono" id="bar-score" style="font-weight:700;font-size:1.1rem;">‚Äî</div>
      <div class="text-xs text-muted">Score</div>
    </div>
  </div>
  <div class="flex items-center gap-8">
    <span style="font-size:1.4rem;">üèÜ</span>
    <div>
      <div class="text-mono" id="bar-wins" style="font-weight:700;font-size:1.1rem;">‚Äî</div>
      <div class="text-xs text-muted">Wins</div>
    </div>
  </div>
</div>

<!-- Mode selector -->
<div class="mode-grid">

  <div class="mode-card offline" onclick="selectMode('offline')">
    <span class="mode-icon">ü§ù</span>
    <h3>Offline Mode</h3>
    <p class="text-muted">Pass-and-play on one device. One player sets the word, the other guesses.</p>
    <div class="badge-item earned mt-16" style="display:inline-flex;">
      <span>‚úì</span> Free to play
    </div>
  </div>

  <div class="mode-card online" onclick="selectMode('online')">
    <span class="mode-icon">üåê</span>
    <h3>Online Multiplayer</h3>
    <p class="text-muted">Create or join a room, set a bet, and battle a real opponent in real-time.</p>
    <span class="mode-badge badge-purple">Score Betting</span>
  </div>

  <div class="mode-card daily" onclick="selectMode('daily')">
    <span class="mode-icon">üìÖ</span>
    <h3>Daily Challenge</h3>
    <p class="text-muted">One word per day. 60 seconds. Win rewards. Compete globally.</p>
    <span class="mode-badge badge-gold">Daily Rewards</span>
  </div>

</div>

<!-- Quick stats -->
<div style="max-width:900px;margin:8px auto 40px;padding:0 24px;">
  <div class="card">
    <div class="flex items-center justify-between mb-16">
      <h3>Your Quick Stats</h3>
      <a href="profile.html" class="btn btn-secondary btn-sm">Full Profile ‚Üí</a>
    </div>
    <div class="stat-grid" id="quick-stats">
      <div class="stat-card"><span class="val" id="qs-wins">‚Äî</span><span class="lbl">Wins</span></div>
      <div class="stat-card"><span class="val" id="qs-losses">‚Äî</span><span class="lbl">Losses</span></div>
      <div class="stat-card"><span class="val" id="qs-total">‚Äî</span><span class="lbl">Games</span></div>
      <div class="stat-card"><span class="val" id="qs-score">‚Äî</span><span class="lbl">Score</span></div>
      <div class="stat-card"><span class="val" id="qs-money">‚Äî</span><span class="lbl">Money</span></div>
      <div class="stat-card"><span class="val" id="qs-level">‚Äî</span><span class="lbl">Level</span></div>
    </div>
    <!-- Level progress -->
    <div class="level-bar-wrap mt-16">
      <div class="level-label">
        <span id="lbl-level">Level 1</span>
        <span id="lbl-progress">0% to next</span>
      </div>
      <div class="level-bar">
        <div class="level-bar-fill" id="level-fill" style="width:0%"></div>
      </div>
    </div>
  </div>
</div>

<script type="module">
import { requireAuth, logoutUser, db, ref, onValue } from './firebase-config.js';
import { showToast, getLevel, getLevelProgress, avatarUrl, fmtNum } from './main.js';

const user = requireAuth('login.html');
if (!user) throw new Error('Not logged in');

// Populate nav
document.getElementById('nav-username').textContent = user.username;
document.getElementById('nav-avatar').src = avatarUrl(user.photoURL, user.username);

// Live user data
const userRef = ref(db, 'users/' + user.uid);
onValue(userRef, snap => {
  if (!snap.exists()) return;
  const d = snap.val();

  document.getElementById('bar-money').textContent = fmtNum(d.money);
  document.getElementById('bar-score').textContent = fmtNum(d.score);
  document.getElementById('bar-wins').textContent  = fmtNum(d.wins);

  document.getElementById('qs-wins').textContent   = fmtNum(d.wins);
  document.getElementById('qs-losses').textContent = fmtNum(d.losses);
  document.getElementById('qs-total').textContent  = fmtNum(d.totalGames);
  document.getElementById('qs-score').textContent  = fmtNum(d.score);
  document.getElementById('qs-money').textContent  = fmtNum(d.money);

  const lvl  = getLevel(d.score);
  const pct  = getLevelProgress(d.score);
  document.getElementById('qs-level').textContent    = lvl;
  document.getElementById('lbl-level').textContent   = `Level ${lvl}`;
  document.getElementById('lbl-progress').textContent= `${Math.round(pct)}% to next`;
  document.getElementById('level-fill').style.width  = pct + '%';
});

// Mode selection
window.selectMode = function(mode) {
  sessionStorage.setItem('ww_mode', mode);
  window.location.href = 'game.html';
};

window.doLogout = async function() {
  await logoutUser(user.uid);
  window.location.href = 'login.html';
};
</script>
</body>
</html>
